(*
 *  File:     $RCSfile: SubBand2.pas,v $
 *  Revision: $Revision: 1.1.1.1 $
 *  Version : $Id: SubBand2.pas,v 1.1.1.1 2002/04/21 12:57:23 fobmagog Exp $
 *  Author:   $Author: fobmagog $
 *  Homepage: http://delphimpeg.sourceforge.net/
 *            Kol translation by Thaddy de Koning
 *
 *  This program is free software; you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation; either version 2 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with this program; if not, write to the Free Software
 *  Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
 *)
unit kolSubBand2;

interface

uses
  Windows, kol, kolShared, kolBitStream, kolSubBand, kolHeader, kolCRC, kolSynthFilter;

type
  // class for layer II subbands in single channel mode:
  PSubBandlayer2 = ^TSubbandlayer2;
  TSubBandLayer2 = object(TSubBand)
  protected
    FSubBandNumber: cardinal;
    FAllocation: cardinal;
    FSCFSI: cardinal;
    FScaleFactor1, FScaleFactor2, FScaleFactor3: single;
    FCodeLength: cardinal;
    FGroupingTable: PSingleArray;
    FFactor: single;
    FGroupNumber: cardinal;
    FSampleNumber: cardinal;
    FSamples: array[0..2] of single;
    FC, FD: single;

    function GetAllocationLength(Header: PHeader): cardinal; virtual;
    procedure PrepareSampleReading(Header: PHeader; Allocation: cardinal;
      var GroupingTable: PSingleArray; var Factor: single; var CodeLength: cardinal;
      var C, D: single); virtual;

  public
    //    constructor Create(SubBandNumber: Cardinal); virtual;

    procedure ReadAllocation(Stream: PBitStream; Header: PHeader; CRC: PCRC16); virtual;
    procedure ReadScaleFactorSelection(Stream: PBitStream; CRC: PCRC16); virtual;
    procedure ReadScaleFactor(Stream: PBitStream; Header: PHeader); virtual;
    function ReadSampleData(Stream: PBitStream): boolean; virtual;
    function PutNextSample(Channels: TChannels;
      Filter1, Filter2: PSynthesisFilter): boolean; virtual;
  end;

  // class for layer II subbands in joint stereo mode:
  PSubBandlayer2IntensityStereo = ^TSubBandLayer2IntensityStereo;
  TSubbandLayer2IntensityStereo = object(TSubbandLayer2)
  protected
    FChannel2SCFSI: cardinal;
    FChannel2ScaleFactor1: single;
    FChannel2ScaleFactor2: single;
    FChannel2ScaleFactor3: single;

  public
    procedure ReadScaleFactorSelection(Stream: PBitStream; CRC: PCRC16); virtual;
    procedure ReadScaleFactor(Stream: PBitStream; Header: PHeader); virtual;
    function PutNextSample(Channels: TChannels;
      Filter1, Filter2: PSynthesisFilter): boolean; virtual;
  end;

  // class for layer II subbands in stereo mode:
  PSubBandlayer2Stereo = ^Tsubbandlayer2stereo;
  TSubbandLayer2Stereo = object(TSubbandLayer2)
  protected
    FChannel2Allocation: cardinal;
    FChannel2SCFSI: cardinal;
    FChannel2ScaleFactor1: single;
    FChannel2ScaleFactor2: single;
    FChannel2ScaleFactor3: single;
    FChannel2Grouping: boolean;
    FChannel2CodeLength: cardinal;
    FChannel2GroupingTable: PSingleArray;
    FChannel2Factor: single;
    FChannel2Samples: array[0..2] of single;
    FChannel2C, FChannel2D: single;

  public
    procedure ReadAllocation(Stream: PBitStream; Header: PHeader; CRC: PCRC16); virtual;
    procedure ReadScaleFactorSelection(Stream: PBitStream; CRC: PCRC16); virtual;
    procedure ReadScaleFactor(Stream: PBitStream; Header: PHeader); virtual;
    function ReadSampleData(Stream: PBitStream): boolean; virtual;
    function PutNextSample(Channels: TChannels;
      Filter1, Filter2: PSynthesisFilter): boolean; virtual;
  end;
function newSubBandLayer2(SubBandNumber: cardinal): Psubbandlayer2;
function newSubBandLayer2Stereo(SubBandNumber: cardinal): Psubbandlayer2Stereo;
function newSubBandLayer2IntensityStereo(SubBandNumber: cardinal)
  : Psubbandlayer2Intensitystereo;

implementation

uses
  kolScaleFac;

const
  // this table contains 3 requantized samples for each legal codeword
  // when grouped in 5 bits, i.e. 3 quantizationsteps per sample
  Grouping5Bits: array[0..27 * 3 - 1] of single = (-2.0 / 3.0, - 2.0 / 3.0, - 2.0 / 3.0,
    0.0, - 2.0 / 3.0, - 2.0 / 3.0,
    2.0 / 3.0, - 2.0 / 3.0, - 2.0 / 3.0, - 2.0 / 3.0,  0.0, - 2.0 / 3.0,
    0.0,      0.0, - 2.0 / 3.0,
    2.0 / 3.0,  0.0, - 2.0 / 3.0, - 2.0 / 3.0,  2.0 / 3.0, - 2.0 / 3.0,
    0.0,      2.0 / 3.0, - 2.0 / 3.0,
    2.0 / 3.0,  2.0 / 3.0, - 2.0 / 3.0, - 2.0 / 3.0, - 2.0 / 3.0,  0.0,
    0.0, - 2.0 / 3.0,  0.0,
    2.0 / 3.0, - 2.0 / 3.0,  0.0, - 2.0 / 3.0,  0.0,      0.0,
    0.0,      0.0,      0.0,
    2.0 / 3.0,  0.0,      0.0, - 2.0 / 3.0,  2.0 / 3.0,  0.0,
    0.0,      2.0 / 3.0,  0.0,
    2.0 / 3.0,  2.0 / 3.0,  0.0, - 2.0 / 3.0, - 2.0 / 3.0,  2.0 / 3.0,
    0.0, - 2.0 / 3.0,  2.0 / 3.0,
    2.0 / 3.0, - 2.0 / 3.0,  2.0 / 3.0, - 2.0 / 3.0,  0.0,      2.0 / 3.0,
    0.0,      0.0,      2.0 / 3.0,
    2.0 / 3.0,  0.0,      2.0 / 3.0, - 2.0 / 3.0,  2.0 / 3.0,  2.0 / 3.0,
    0.0,      2.0 / 3.0,  2.0 / 3.0,
    2.0 / 3.0,  2.0 / 3.0,  2.0 / 3.0);

  // this table contains 3 requantized samples for each legal codeword
  // when grouped in 7 bits, i.e. 5 quantizationsteps per sample
  Grouping7Bits: array[0..125 * 3 - 1] of
  single = (-0.8, - 0.8, - 0.8, - 0.4, - 0.8, - 0.8,    0.0, - 0.8, -
    0.8,    0.4, - 0.8, - 0.8,    0.8, - 0.8, - 0.8, - 0.8, - 0.4, - 0.8, -
    0.4, - 0.4, - 0.8,    0.0, - 0.4, - 0.8,    0.4, - 0.4, - 0.8,    0.8, -
    0.4, - 0.8, - 0.8,  0.0, - 0.8, - 0.4,  0.0, - 0.8,    0.0,  0.0, -
    0.8,    0.4,  0.0, - 0.8,    0.8,  0.0, - 0.8, - 0.8,  0.4, - 0.8, -
    0.4,  0.4, - 0.8,    0.0,  0.4, - 0.8,    0.4,  0.4, - 0.8,    0.8,  0.4, -
    0.8, - 0.8,  0.8, - 0.8, - 0.4,  0.8, - 0.8,    0.0,  0.8, -
    0.8,    0.4,  0.8, - 0.8,    0.8,  0.8, - 0.8, - 0.8, - 0.8, - 0.4, -
    0.4, - 0.8, - 0.4,    0.0, - 0.8, - 0.4,    0.4, - 0.8, - 0.4,    0.8, -
    0.8, - 0.4, - 0.8, - 0.4, - 0.4, - 0.4, - 0.4, - 0.4,    0.0, - 0.4, -
    0.4,    0.4, - 0.4, - 0.4,    0.8, - 0.4, - 0.4, - 0.8,  0.0, - 0.4, -
    0.4,  0.0, - 0.4,    0.0,  0.0, - 0.4,    0.4,  0.0, - 0.4,    0.8,  0.0, -
    0.4, - 0.8,  0.4, - 0.4, - 0.4,  0.4, - 0.4,    0.0,  0.4, -
    0.4,    0.4,  0.4, - 0.4,    0.8,  0.4, - 0.4, - 0.8,  0.8, - 0.4, -
    0.4,  0.8, - 0.4,    0.0,  0.8, - 0.4,    0.4,  0.8, - 0.4,    0.8,  0.8, -
    0.4, - 0.8, - 0.8,  0.0, - 0.4, - 0.8,  0.0,    0.0, - 0.8,  0.0,    0.4, -
    0.8,  0.0,    0.8, - 0.8,  0.0, - 0.8, - 0.4,  0.0, - 0.4, -
    0.4,  0.0,    0.0, - 0.4,  0.0,    0.4, - 0.4,  0.0,    0.8, - 0.4,  0.0, -
    0.8,  0.0,  0.0, - 0.4,  0.0,  0.0,    0.0,  0.0,  0.0,    0.4,  0.0,
    0.0,    0.8,  0.0,  0.0, - 0.8,  0.4,  0.0, -
    0.4,  0.4,  0.0,    0.0,  0.4,  0.0,    0.4,  0.4,  0.0,    0.8,  0.4,  0.0, -
    0.8,  0.8,  0.0, - 0.4,  0.8,  0.0,    0.0,  0.8,  0.0,    0.4,  0.8,
    0.0,    0.8,  0.8,  0.0, - 0.8, - 0.8,  0.4, - 0.4, - 0.8,  0.4,    0.0, -
    0.8,  0.4,    0.4, - 0.8,  0.4,    0.8, - 0.8,  0.4, - 0.8, - 0.4,  0.4, -
    0.4, - 0.4,  0.4,    0.0, - 0.4,  0.4,    0.4, - 0.4,  0.4,    0.8, -
    0.4,  0.4, - 0.8,  0.0,  0.4, - 0.4,  0.0,  0.4,    0.0,  0.0,  0.4,
    0.4,  0.0,  0.4,    0.8,  0.0,  0.4, - 0.8,  0.4,  0.4, -
    0.4,  0.4,  0.4,    0.0,  0.4,  0.4,    0.4,  0.4,  0.4,    0.8,  0.4,  0.4, -
    0.8,  0.8,  0.4, - 0.4,  0.8,  0.4,    0.0,  0.8,  0.4,    0.4,  0.8,
    0.4,    0.8,  0.8,  0.4, - 0.8, - 0.8,  0.8, - 0.4, - 0.8,  0.8,    0.0, -
    0.8,  0.8,    0.4, - 0.8,  0.8,    0.8, - 0.8,  0.8, - 0.8, - 0.4,  0.8, -
    0.4, - 0.4,  0.8,    0.0, - 0.4,  0.8,    0.4, - 0.4,  0.8,    0.8, -
    0.4,  0.8, - 0.8,  0.0,  0.8, - 0.4,  0.0,  0.8,    0.0,  0.0,  0.8,
    0.4,  0.0,  0.8,    0.8,  0.0,  0.8, - 0.8,  0.4,  0.8, -
    0.4,  0.4,  0.8,    0.0,  0.4,  0.8,    0.4,  0.4,  0.8,    0.8,  0.4,  0.8, -
    0.8,  0.8,  0.8, - 0.4,  0.8,  0.8,    0.0,  0.8,  0.8,    0.4,  0.8,
    0.8,    0.8,  0.8,  0.8);

  // this table contains 3 requantized samples for each legal codeword
  // when grouped in 10 bits, i.e. 9 quantizationsteps per sample
  Grouping10Bits: array[0..729 * 3 - 1] of
  single = (-8.0 / 9.0, - 8.0 / 9.0, - 8.0 / 9.0, - 6.0 / 9.0, - 8.0 /
    9.0, - 8.0 / 9.0, - 4.0 / 9.0, - 8.0 / 9.0, - 8.0 / 9.0, - 2.0 / 9.0, -
    8.0 / 9.0, - 8.0 / 9.0,        0.0, - 8.0 / 9.0, - 8.0 / 9.0,    2.0 /
    9.0, - 8.0 / 9.0, - 8.0 / 9.0,
    4.0 / 9.0, - 8.0 / 9.0, - 8.0 / 9.0,    6.0 / 9.0, - 8.0 / 9.0, -
    8.0 / 9.0,    8.0 / 9.0, - 8.0 / 9.0, - 8.0 / 9.0, - 8.0 / 9.0, -
    6.0 / 9.0, - 8.0 / 9.0, - 6.0 / 9.0, - 6.0 / 9.0, - 8.0 / 9.0, - 4.0 /
    9.0, - 6.0 / 9.0, - 8.0 / 9.0, - 2.0 / 9.0, - 6.0 / 9.0, - 8.0 /
    9.0,        0.0, - 6.0 / 9.0, - 8.0 / 9.0,    2.0 / 9.0, - 6.0 / 9.0, - 8.0 / 9.0,
    4.0 / 9.0, - 6.0 / 9.0, - 8.0 / 9.0,    6.0 / 9.0, - 6.0 / 9.0, -
    8.0 / 9.0,    8.0 / 9.0, - 6.0 / 9.0, - 8.0 / 9.0, - 8.0 / 9.0, -
    4.0 / 9.0, - 8.0 / 9.0, - 6.0 / 9.0, - 4.0 / 9.0, - 8.0 / 9.0, - 4.0 /
    9.0, - 4.0 / 9.0, - 8.0 / 9.0, - 2.0 / 9.0, - 4.0 / 9.0, - 8.0 /
    9.0,        0.0, - 4.0 / 9.0, - 8.0 / 9.0,    2.0 / 9.0, - 4.0 / 9.0, - 8.0 / 9.0,
    4.0 / 9.0, - 4.0 / 9.0, - 8.0 / 9.0,    6.0 / 9.0, - 4.0 / 9.0, -
    8.0 / 9.0,    8.0 / 9.0, - 4.0 / 9.0, - 8.0 / 9.0, - 8.0 / 9.0, -
    2.0 / 9.0, - 8.0 / 9.0, - 6.0 / 9.0, - 2.0 / 9.0, - 8.0 / 9.0, - 4.0 /
    9.0, - 2.0 / 9.0, - 8.0 / 9.0, - 2.0 / 9.0, - 2.0 / 9.0, - 8.0 /
    9.0,        0.0, - 2.0 / 9.0, - 8.0 / 9.0,    2.0 / 9.0, - 2.0 / 9.0, - 8.0 / 9.0,
    4.0 / 9.0, - 2.0 / 9.0, - 8.0 / 9.0,    6.0 / 9.0, - 2.0 / 9.0, -
    8.0 / 9.0,    8.0 / 9.0, - 2.0 / 9.0, - 8.0 / 9.0, - 8.0 / 9.0,      0.0, -
    8.0 / 9.0, - 6.0 / 9.0,      0.0, - 8.0 / 9.0, - 4.0 / 9.0,      0.0, -
    8.0 / 9.0, - 2.0 / 9.0,      0.0, - 8.0 / 9.0,        0.0,      0.0, - 8.0 /
    9.0,    2.0 / 9.0,      0.0, - 8.0 / 9.0,
    4.0 / 9.0,      0.0, - 8.0 / 9.0,    6.0 / 9.0,      0.0, - 8.0 /
    9.0,    8.0 / 9.0,      0.0, - 8.0 / 9.0, - 8.0 / 9.0,  2.0 / 9.0, -
    8.0 / 9.0, - 6.0 / 9.0,  2.0 / 9.0, - 8.0 / 9.0, - 4.0 / 9.0,  2.0 /
    9.0, - 8.0 / 9.0, - 2.0 / 9.0,  2.0 / 9.0, - 8.0 / 9.0,        0.0,  2.0 /
    9.0, - 8.0 / 9.0,    2.0 / 9.0,  2.0 / 9.0, - 8.0 / 9.0,
    4.0 / 9.0,  2.0 / 9.0, - 8.0 / 9.0,    6.0 / 9.0,  2.0 / 9.0, -
    8.0 / 9.0,    8.0 / 9.0,  2.0 / 9.0, - 8.0 / 9.0, - 8.0 / 9.0,  4.0 /
    9.0, - 8.0 / 9.0, - 6.0 / 9.0,  4.0 / 9.0, - 8.0 / 9.0, - 4.0 / 9.0,  4.0 /
    9.0, - 8.0 / 9.0, - 2.0 / 9.0,  4.0 / 9.0, - 8.0 / 9.0,        0.0,  4.0 /
    9.0, - 8.0 / 9.0,    2.0 / 9.0,  4.0 / 9.0, - 8.0 / 9.0,
    4.0 / 9.0,  4.0 / 9.0, - 8.0 / 9.0,    6.0 / 9.0,  4.0 / 9.0, -
    8.0 / 9.0,    8.0 / 9.0,  4.0 / 9.0, - 8.0 / 9.0, - 8.0 / 9.0,  6.0 /
    9.0, - 8.0 / 9.0, - 6.0 / 9.0,  6.0 / 9.0, - 8.0 / 9.0, - 4.0 / 9.0,  6.0 /
    9.0, - 8.0 / 9.0, - 2.0 / 9.0,  6.0 / 9.0, - 8.0 / 9.0,        0.0,  6.0 /
    9.0, - 8.0 / 9.0,    2.0 / 9.0,  6.0 / 9.0, - 8.0 / 9.0,
    4.0 / 9.0,  6.0 / 9.0, - 8.0 / 9.0,    6.0 / 9.0,  6.0 / 9.0, -
    8.0 / 9.0,    8.0 / 9.0,  6.0 / 9.0, - 8.0 / 9.0, - 8.0 / 9.0,  8.0 /
    9.0, - 8.0 / 9.0, - 6.0 / 9.0,  8.0 / 9.0, - 8.0 / 9.0, - 4.0 / 9.0,  8.0 /
    9.0, - 8.0 / 9.0, - 2.0 / 9.0,  8.0 / 9.0, - 8.0 / 9.0,        0.0,  8.0 /
    9.0, - 8.0 / 9.0,    2.0 / 9.0,  8.0 / 9.0, - 8.0 / 9.0,
    4.0 / 9.0,  8.0 / 9.0, - 8.0 / 9.0,    6.0 / 9.0,  8.0 / 9.0, -
    8.0 / 9.0,    8.0 / 9.0,  8.0 / 9.0, - 8.0 / 9.0, - 8.0 / 9.0, - 8.0 /
    9.0, - 6.0 / 9.0, - 6.0 / 9.0, - 8.0 / 9.0, - 6.0 / 9.0, - 4.0 / 9.0, -
    8.0 / 9.0, - 6.0 / 9.0, - 2.0 / 9.0, - 8.0 / 9.0, - 6.0 / 9.0,        0.0, -
    8.0 / 9.0, - 6.0 / 9.0,    2.0 / 9.0, - 8.0 / 9.0, - 6.0 / 9.0,
    4.0 / 9.0, - 8.0 / 9.0, - 6.0 / 9.0,    6.0 / 9.0, - 8.0 / 9.0, -
    6.0 / 9.0,    8.0 / 9.0, - 8.0 / 9.0, - 6.0 / 9.0, - 8.0 / 9.0, -
    6.0 / 9.0, - 6.0 / 9.0, - 6.0 / 9.0, - 6.0 / 9.0, - 6.0 / 9.0, - 4.0 /
    9.0, - 6.0 / 9.0, - 6.0 / 9.0, - 2.0 / 9.0, - 6.0 / 9.0, - 6.0 /
    9.0,        0.0, - 6.0 / 9.0, - 6.0 / 9.0,    2.0 / 9.0, - 6.0 / 9.0, - 6.0 / 9.0,
    4.0 / 9.0, - 6.0 / 9.0, - 6.0 / 9.0,    6.0 / 9.0, - 6.0 / 9.0, -
    6.0 / 9.0,    8.0 / 9.0, - 6.0 / 9.0, - 6.0 / 9.0, - 8.0 / 9.0, -
    4.0 / 9.0, - 6.0 / 9.0, - 6.0 / 9.0, - 4.0 / 9.0, - 6.0 / 9.0, - 4.0 /
    9.0, - 4.0 / 9.0, - 6.0 / 9.0, - 2.0 / 9.0, - 4.0 / 9.0, - 6.0 /
    9.0,        0.0, - 4.0 / 9.0, - 6.0 / 9.0,    2.0 / 9.0, - 4.0 / 9.0, - 6.0 / 9.0,
    4.0 / 9.0, - 4.0 / 9.0, - 6.0 / 9.0,    6.0 / 9.0, - 4.0 / 9.0, -
    6.0 / 9.0,    8.0 / 9.0, - 4.0 / 9.0, - 6.0 / 9.0, - 8.0 / 9.0, -
    2.0 / 9.0, - 6.0 / 9.0, - 6.0 / 9.0, - 2.0 / 9.0, - 6.0 / 9.0, - 4.0 /
    9.0, - 2.0 / 9.0, - 6.0 / 9.0, - 2.0 / 9.0, - 2.0 / 9.0, - 6.0 /
    9.0,        0.0, - 2.0 / 9.0, - 6.0 / 9.0,    2.0 / 9.0, - 2.0 / 9.0, - 6.0 / 9.0,
    4.0 / 9.0, - 2.0 / 9.0, - 6.0 / 9.0,    6.0 / 9.0, - 2.0 / 9.0, -
    6.0 / 9.0,    8.0 / 9.0, - 2.0 / 9.0, - 6.0 / 9.0, - 8.0 / 9.0,      0.0, -
    6.0 / 9.0, - 6.0 / 9.0,      0.0, - 6.0 / 9.0, - 4.0 / 9.0,      0.0, -
    6.0 / 9.0, - 2.0 / 9.0,      0.0, - 6.0 / 9.0,        0.0,      0.0, - 6.0 /
    9.0,    2.0 / 9.0,      0.0, - 6.0 / 9.0,
    4.0 / 9.0,      0.0, - 6.0 / 9.0,    6.0 / 9.0,      0.0, - 6.0 /
    9.0,    8.0 / 9.0,      0.0, - 6.0 / 9.0, - 8.0 / 9.0,  2.0 / 9.0, -
    6.0 / 9.0, - 6.0 / 9.0,  2.0 / 9.0, - 6.0 / 9.0, - 4.0 / 9.0,  2.0 /
    9.0, - 6.0 / 9.0, - 2.0 / 9.0,  2.0 / 9.0, - 6.0 / 9.0,        0.0,  2.0 /
    9.0, - 6.0 / 9.0,    2.0 / 9.0,  2.0 / 9.0, - 6.0 / 9.0,
    4.0 / 9.0,  2.0 / 9.0, - 6.0 / 9.0,    6.0 / 9.0,  2.0 / 9.0, -
    6.0 / 9.0,    8.0 / 9.0,  2.0 / 9.0, - 6.0 / 9.0, - 8.0 / 9.0,  4.0 /
    9.0, - 6.0 / 9.0, - 6.0 / 9.0,  4.0 / 9.0, - 6.0 / 9.0, - 4.0 / 9.0,  4.0 /
    9.0, - 6.0 / 9.0, - 2.0 / 9.0,  4.0 / 9.0, - 6.0 / 9.0,        0.0,  4.0 /
    9.0, - 6.0 / 9.0,    2.0 / 9.0,  4.0 / 9.0, - 6.0 / 9.0,
    4.0 / 9.0,  4.0 / 9.0, - 6.0 / 9.0,    6.0 / 9.0,  4.0 / 9.0, -
    6.0 / 9.0,    8.0 / 9.0,  4.0 / 9.0, - 6.0 / 9.0, - 8.0 / 9.0,  6.0 /
    9.0, - 6.0 / 9.0, - 6.0 / 9.0,  6.0 / 9.0, - 6.0 / 9.0, - 4.0 / 9.0,  6.0 /
    9.0, - 6.0 / 9.0, - 2.0 / 9.0,  6.0 / 9.0, - 6.0 / 9.0,        0.0,  6.0 /
    9.0, - 6.0 / 9.0,    2.0 / 9.0,  6.0 / 9.0, - 6.0 / 9.0,
    4.0 / 9.0,  6.0 / 9.0, - 6.0 / 9.0,    6.0 / 9.0,  6.0 / 9.0, -
    6.0 / 9.0,    8.0 / 9.0,  6.0 / 9.0, - 6.0 / 9.0, - 8.0 / 9.0,  8.0 /
    9.0, - 6.0 / 9.0, - 6.0 / 9.0,  8.0 / 9.0, - 6.0 / 9.0, - 4.0 / 9.0,  8.0 /
    9.0, - 6.0 / 9.0, - 2.0 / 9.0,  8.0 / 9.0, - 6.0 / 9.0,        0.0,  8.0 /
    9.0, - 6.0 / 9.0,    2.0 / 9.0,  8.0 / 9.0, - 6.0 / 9.0,
    4.0 / 9.0,  8.0 / 9.0, - 6.0 / 9.0,    6.0 / 9.0,  8.0 / 9.0, -
    6.0 / 9.0,    8.0 / 9.0,  8.0 / 9.0, - 6.0 / 9.0, - 8.0 / 9.0, - 8.0 /
    9.0, - 4.0 / 9.0, - 6.0 / 9.0, - 8.0 / 9.0, - 4.0 / 9.0, - 4.0 / 9.0, -
    8.0 / 9.0, - 4.0 / 9.0, - 2.0 / 9.0, - 8.0 / 9.0, - 4.0 / 9.0,        0.0, -
    8.0 / 9.0, - 4.0 / 9.0,    2.0 / 9.0, - 8.0 / 9.0, - 4.0 / 9.0,
    4.0 / 9.0, - 8.0 / 9.0, - 4.0 / 9.0,    6.0 / 9.0, - 8.0 / 9.0, -
    4.0 / 9.0,    8.0 / 9.0, - 8.0 / 9.0, - 4.0 / 9.0, - 8.0 / 9.0, -
    6.0 / 9.0, - 4.0 / 9.0, - 6.0 / 9.0, - 6.0 / 9.0, - 4.0 / 9.0, - 4.0 /
    9.0, - 6.0 / 9.0, - 4.0 / 9.0, - 2.0 / 9.0, - 6.0 / 9.0, - 4.0 /
    9.0,        0.0, - 6.0 / 9.0, - 4.0 / 9.0,    2.0 / 9.0, - 6.0 / 9.0, - 4.0 / 9.0,
    4.0 / 9.0, - 6.0 / 9.0, - 4.0 / 9.0,    6.0 / 9.0, - 6.0 / 9.0, -
    4.0 / 9.0,    8.0 / 9.0, - 6.0 / 9.0, - 4.0 / 9.0, - 8.0 / 9.0, -
    4.0 / 9.0, - 4.0 / 9.0, - 6.0 / 9.0, - 4.0 / 9.0, - 4.0 / 9.0, - 4.0 /
    9.0, - 4.0 / 9.0, - 4.0 / 9.0, - 2.0 / 9.0, - 4.0 / 9.0, - 4.0 /
    9.0,        0.0, - 4.0 / 9.0, - 4.0 / 9.0,    2.0 / 9.0, - 4.0 / 9.0, - 4.0 / 9.0,
    4.0 / 9.0, - 4.0 / 9.0, - 4.0 / 9.0,    6.0 / 9.0, - 4.0 / 9.0, -
    4.0 / 9.0,    8.0 / 9.0, - 4.0 / 9.0, - 4.0 / 9.0, - 8.0 / 9.0, -
    2.0 / 9.0, - 4.0 / 9.0, - 6.0 / 9.0, - 2.0 / 9.0, - 4.0 / 9.0, - 4.0 /
    9.0, - 2.0 / 9.0, - 4.0 / 9.0, - 2.0 / 9.0, - 2.0 / 9.0, - 4.0 /
    9.0,        0.0, - 2.0 / 9.0, - 4.0 / 9.0,    2.0 / 9.0, - 2.0 / 9.0, - 4.0 / 9.0,
    4.0 / 9.0, - 2.0 / 9.0, - 4.0 / 9.0,    6.0 / 9.0, - 2.0 / 9.0, -
    4.0 / 9.0,    8.0 / 9.0, - 2.0 / 9.0, - 4.0 / 9.0, - 8.0 / 9.0,      0.0, -
    4.0 / 9.0, - 6.0 / 9.0,      0.0, - 4.0 / 9.0, - 4.0 / 9.0,      0.0, -
    4.0 / 9.0, - 2.0 / 9.0,      0.0, - 4.0 / 9.0,        0.0,      0.0, - 4.0 /
    9.0,    2.0 / 9.0,      0.0, - 4.0 / 9.0,
    4.0 / 9.0,      0.0, - 4.0 / 9.0,    6.0 / 9.0,      0.0, - 4.0 /
    9.0,    8.0 / 9.0,      0.0, - 4.0 / 9.0, - 8.0 / 9.0,  2.0 / 9.0, -
    4.0 / 9.0, - 6.0 / 9.0,  2.0 / 9.0, - 4.0 / 9.0, - 4.0 / 9.0,  2.0 /
    9.0, - 4.0 / 9.0, - 2.0 / 9.0,  2.0 / 9.0, - 4.0 / 9.0,        0.0,  2.0 /
    9.0, - 4.0 / 9.0,    2.0 / 9.0,  2.0 / 9.0, - 4.0 / 9.0,
    4.0 / 9.0,  2.0 / 9.0, - 4.0 / 9.0,    6.0 / 9.0,  2.0 / 9.0, -
    4.0 / 9.0,    8.0 / 9.0,  2.0 / 9.0, - 4.0 / 9.0, - 8.0 / 9.0,  4.0 /
    9.0, - 4.0 / 9.0, - 6.0 / 9.0,  4.0 / 9.0, - 4.0 / 9.0, - 4.0 / 9.0,  4.0 /
    9.0, - 4.0 / 9.0, - 2.0 / 9.0,  4.0 / 9.0, - 4.0 / 9.0,        0.0,  4.0 /
    9.0, - 4.0 / 9.0,    2.0 / 9.0,  4.0 / 9.0, - 4.0 / 9.0,
    4.0 / 9.0,  4.0 / 9.0, - 4.0 / 9.0,    6.0 / 9.0,  4.0 / 9.0, -
    4.0 / 9.0,    8.0 / 9.0,  4.0 / 9.0, - 4.0 / 9.0, - 8.0 / 9.0,  6.0 /
    9.0, - 4.0 / 9.0, - 6.0 / 9.0,  6.0 / 9.0, - 4.0 / 9.0, - 4.0 / 9.0,  6.0 /
    9.0, - 4.0 / 9.0, - 2.0 / 9.0,  6.0 / 9.0, - 4.0 / 9.0,        0.0,  6.0 /
    9.0, - 4.0 / 9.0,    2.0 / 9.0,  6.0 / 9.0, - 4.0 / 9.0,
    4.0 / 9.0,  6.0 / 9.0, - 4.0 / 9.0,    6.0 / 9.0,  6.0 / 9.0, -
    4.0 / 9.0,    8.0 / 9.0,  6.0 / 9.0, - 4.0 / 9.0, - 8.0 / 9.0,  8.0 /
    9.0, - 4.0 / 9.0, - 6.0 / 9.0,  8.0 / 9.0, - 4.0 / 9.0, - 4.0 / 9.0,  8.0 /
    9.0, - 4.0 / 9.0, - 2.0 / 9.0,  8.0 / 9.0, - 4.0 / 9.0,        0.0,  8.0 /
    9.0, - 4.0 / 9.0,    2.0 / 9.0,  8.0 / 9.0, - 4.0 / 9.0,
    4.0 / 9.0,  8.0 / 9.0, - 4.0 / 9.0,    6.0 / 9.0,  8.0 / 9.0, -
    4.0 / 9.0,    8.0 / 9.0,  8.0 / 9.0, - 4.0 / 9.0, - 8.0 / 9.0, - 8.0 /
    9.0, - 2.0 / 9.0, - 6.0 / 9.0, - 8.0 / 9.0, - 2.0 / 9.0, - 4.0 / 9.0, -
    8.0 / 9.0, - 2.0 / 9.0, - 2.0 / 9.0, - 8.0 / 9.0, - 2.0 / 9.0,        0.0, -
    8.0 / 9.0, - 2.0 / 9.0,    2.0 / 9.0, - 8.0 / 9.0, - 2.0 / 9.0,
    4.0 / 9.0, - 8.0 / 9.0, - 2.0 / 9.0,    6.0 / 9.0, - 8.0 / 9.0, -
    2.0 / 9.0,    8.0 / 9.0, - 8.0 / 9.0, - 2.0 / 9.0, - 8.0 / 9.0, -
    6.0 / 9.0, - 2.0 / 9.0, - 6.0 / 9.0, - 6.0 / 9.0, - 2.0 / 9.0, - 4.0 /
    9.0, - 6.0 / 9.0, - 2.0 / 9.0, - 2.0 / 9.0, - 6.0 / 9.0, - 2.0 /
    9.0,        0.0, - 6.0 / 9.0, - 2.0 / 9.0,    2.0 / 9.0, - 6.0 / 9.0, - 2.0 / 9.0,
    4.0 / 9.0, - 6.0 / 9.0, - 2.0 / 9.0,    6.0 / 9.0, - 6.0 / 9.0, -
    2.0 / 9.0,    8.0 / 9.0, - 6.0 / 9.0, - 2.0 / 9.0, - 8.0 / 9.0, -
    4.0 / 9.0, - 2.0 / 9.0, - 6.0 / 9.0, - 4.0 / 9.0, - 2.0 / 9.0, - 4.0 /
    9.0, - 4.0 / 9.0, - 2.0 / 9.0, - 2.0 / 9.0, - 4.0 / 9.0, - 2.0 /
    9.0,        0.0, - 4.0 / 9.0, - 2.0 / 9.0,    2.0 / 9.0, - 4.0 / 9.0, - 2.0 / 9.0,
    4.0 / 9.0, - 4.0 / 9.0, - 2.0 / 9.0,    6.0 / 9.0, - 4.0 / 9.0, -
    2.0 / 9.0,    8.0 / 9.0, - 4.0 / 9.0, - 2.0 / 9.0, - 8.0 / 9.0, -
    2.0 / 9.0, - 2.0 / 9.0, - 6.0 / 9.0, - 2.0 / 9.0, - 2.0 / 9.0, - 4.0 /
    9.0, - 2.0 / 9.0, - 2.0 / 9.0, - 2.0 / 9.0, - 2.0 / 9.0, - 2.0 /
    9.0,        0.0, - 2.0 / 9.0, - 2.0 / 9.0,    2.0 / 9.0, - 2.0 / 9.0, - 2.0 / 9.0,
    4.0 / 9.0, - 2.0 / 9.0, - 2.0 / 9.0,    6.0 / 9.0, - 2.0 / 9.0, -
    2.0 / 9.0,    8.0 / 9.0, - 2.0 / 9.0, - 2.0 / 9.0, - 8.0 / 9.0,      0.0, -
    2.0 / 9.0, - 6.0 / 9.0,      0.0, - 2.0 / 9.0, - 4.0 / 9.0,      0.0, -
    2.0 / 9.0, - 2.0 / 9.0,      0.0, - 2.0 / 9.0,        0.0,      0.0, - 2.0 /
    9.0,    2.0 / 9.0,      0.0, - 2.0 / 9.0,
    4.0 / 9.0,      0.0, - 2.0 / 9.0,    6.0 / 9.0,      0.0, - 2.0 /
    9.0,    8.0 / 9.0,      0.0, - 2.0 / 9.0, - 8.0 / 9.0,  2.0 / 9.0, -
    2.0 / 9.0, - 6.0 / 9.0,  2.0 / 9.0, - 2.0 / 9.0, - 4.0 / 9.0,  2.0 /
    9.0, - 2.0 / 9.0, - 2.0 / 9.0,  2.0 / 9.0, - 2.0 / 9.0,        0.0,  2.0 /
    9.0, - 2.0 / 9.0,    2.0 / 9.0,  2.0 / 9.0, - 2.0 / 9.0,
    4.0 / 9.0,  2.0 / 9.0, - 2.0 / 9.0,    6.0 / 9.0,  2.0 / 9.0, -
    2.0 / 9.0,    8.0 / 9.0,  2.0 / 9.0, - 2.0 / 9.0, - 8.0 / 9.0,  4.0 /
    9.0, - 2.0 / 9.0, - 6.0 / 9.0,  4.0 / 9.0, - 2.0 / 9.0, - 4.0 / 9.0,  4.0 /
    9.0, - 2.0 / 9.0, - 2.0 / 9.0,  4.0 / 9.0, - 2.0 / 9.0,        0.0,  4.0 /
    9.0, - 2.0 / 9.0,    2.0 / 9.0,  4.0 / 9.0, - 2.0 / 9.0,
    4.0 / 9.0,  4.0 / 9.0, - 2.0 / 9.0,    6.0 / 9.0,  4.0 / 9.0, -
    2.0 / 9.0,    8.0 / 9.0,  4.0 / 9.0, - 2.0 / 9.0, - 8.0 / 9.0,  6.0 /
    9.0, - 2.0 / 9.0, - 6.0 / 9.0,  6.0 / 9.0, - 2.0 / 9.0, - 4.0 / 9.0,  6.0 /
    9.0, - 2.0 / 9.0, - 2.0 / 9.0,  6.0 / 9.0, - 2.0 / 9.0,        0.0,  6.0 /
    9.0, - 2.0 / 9.0,    2.0 / 9.0,  6.0 / 9.0, - 2.0 / 9.0,
    4.0 / 9.0,  6.0 / 9.0, - 2.0 / 9.0,    6.0 / 9.0,  6.0 / 9.0, -
    2.0 / 9.0,    8.0 / 9.0,  6.0 / 9.0, - 2.0 / 9.0, - 8.0 / 9.0,  8.0 /
    9.0, - 2.0 / 9.0, - 6.0 / 9.0,  8.0 / 9.0, - 2.0 / 9.0, - 4.0 / 9.0,  8.0 /
    9.0, - 2.0 / 9.0, - 2.0 / 9.0,  8.0 / 9.0, - 2.0 / 9.0,        0.0,  8.0 /
    9.0, - 2.0 / 9.0,    2.0 / 9.0,  8.0 / 9.0, - 2.0 / 9.0,
    4.0 / 9.0,  8.0 / 9.0, - 2.0 / 9.0,    6.0 / 9.0,  8.0 / 9.0, -
    2.0 / 9.0,    8.0 / 9.0,  8.0 / 9.0, - 2.0 / 9.0, - 8.0 / 9.0, - 8.0 /
    9.0,      0.0, - 6.0 / 9.0, - 8.0 / 9.0,      0.0, - 4.0 / 9.0, -
    8.0 / 9.0,      0.0, - 2.0 / 9.0, - 8.0 / 9.0,      0.0,        0.0, - 8.0 /
    9.0,      0.0,    2.0 / 9.0, - 8.0 / 9.0,      0.0,
    4.0 / 9.0, - 8.0 / 9.0,      0.0,    6.0 / 9.0, - 8.0 /
    9.0,      0.0,    8.0 / 9.0, - 8.0 / 9.0,      0.0, - 8.0 / 9.0, -
    6.0 / 9.0,      0.0, - 6.0 / 9.0, - 6.0 / 9.0,      0.0, - 4.0 / 9.0, -
    6.0 / 9.0,      0.0, - 2.0 / 9.0, - 6.0 / 9.0,      0.0,        0.0, - 6.0 /
    9.0,      0.0,    2.0 / 9.0, - 6.0 / 9.0,      0.0,
    4.0 / 9.0, - 6.0 / 9.0,      0.0,    6.0 / 9.0, - 6.0 /
    9.0,      0.0,    8.0 / 9.0, - 6.0 / 9.0,      0.0, - 8.0 / 9.0, -
    4.0 / 9.0,      0.0, - 6.0 / 9.0, - 4.0 / 9.0,      0.0, - 4.0 / 9.0, -
    4.0 / 9.0,      0.0, - 2.0 / 9.0, - 4.0 / 9.0,      0.0,        0.0, - 4.0 /
    9.0,      0.0,    2.0 / 9.0, - 4.0 / 9.0,      0.0,
    4.0 / 9.0, - 4.0 / 9.0,      0.0,    6.0 / 9.0, - 4.0 /
    9.0,      0.0,    8.0 / 9.0, - 4.0 / 9.0,      0.0, - 8.0 / 9.0, -
    2.0 / 9.0,      0.0, - 6.0 / 9.0, - 2.0 / 9.0,      0.0, - 4.0 / 9.0, -
    2.0 / 9.0,      0.0, - 2.0 / 9.0, - 2.0 / 9.0,      0.0,        0.0, - 2.0 /
    9.0,      0.0,    2.0 / 9.0, - 2.0 / 9.0,      0.0,
    4.0 / 9.0, - 2.0 / 9.0,      0.0,    6.0 / 9.0, - 2.0 /
    9.0,      0.0,    8.0 / 9.0, - 2.0 / 9.0,      0.0, - 8.0 /
    9.0,      0.0,      0.0, - 6.0 / 9.0,      0.0,      0.0, - 4.0 /
    9.0,      0.0,      0.0, - 2.0 / 9.0,      0.0,      0.0,        0.0,
    0.0,      0.0,    2.0 / 9.0,      0.0,      0.0,
    4.0 / 9.0,      0.0,      0.0,    6.0 / 9.0,      0.0,      0.0,    8.0 /
    9.0,      0.0,      0.0, - 8.0 / 9.0,  2.0 / 9.0,      0.0, - 6.0 /
    9.0,  2.0 / 9.0,      0.0, - 4.0 / 9.0,  2.0 / 9.0,      0.0, - 2.0 /
    9.0,  2.0 / 9.0,      0.0,        0.0,  2.0 / 9.0,      0.0,    2.0 /
    9.0,  2.0 / 9.0,      0.0,
    4.0 / 9.0,  2.0 / 9.0,      0.0,    6.0 / 9.0,  2.0 / 9.0,      0.0,    8.0 /
    9.0,  2.0 / 9.0,      0.0, - 8.0 / 9.0,  4.0 / 9.0,      0.0, - 6.0 /
    9.0,  4.0 / 9.0,      0.0, - 4.0 / 9.0,  4.0 / 9.0,      0.0, - 2.0 /
    9.0,  4.0 / 9.0,      0.0,        0.0,  4.0 / 9.0,      0.0,    2.0 /
    9.0,  4.0 / 9.0,      0.0,
    4.0 / 9.0,  4.0 / 9.0,      0.0,    6.0 / 9.0,  4.0 / 9.0,      0.0,    8.0 /
    9.0,  4.0 / 9.0,      0.0, - 8.0 / 9.0,  6.0 / 9.0,      0.0, - 6.0 /
    9.0,  6.0 / 9.0,      0.0, - 4.0 / 9.0,  6.0 / 9.0,      0.0, - 2.0 /
    9.0,  6.0 / 9.0,      0.0,        0.0,  6.0 / 9.0,      0.0,    2.0 /
    9.0,  6.0 / 9.0,      0.0,
    4.0 / 9.0,  6.0 / 9.0,      0.0,    6.0 / 9.0,  6.0 / 9.0,      0.0,    8.0 /
    9.0,  6.0 / 9.0,      0.0, - 8.0 / 9.0,  8.0 / 9.0,      0.0, - 6.0 /
    9.0,  8.0 / 9.0,      0.0, - 4.0 / 9.0,  8.0 / 9.0,      0.0, - 2.0 /
    9.0,  8.0 / 9.0,      0.0,        0.0,  8.0 / 9.0,      0.0,    2.0 /
    9.0,  8.0 / 9.0,      0.0,
    4.0 / 9.0,  8.0 / 9.0,      0.0,    6.0 / 9.0,  8.0 / 9.0,      0.0,    8.0 /
    9.0,  8.0 / 9.0,      0.0, - 8.0 / 9.0, - 8.0 / 9.0,  2.0 / 9.0, -
    6.0 / 9.0, - 8.0 / 9.0,  2.0 / 9.0, - 4.0 / 9.0, - 8.0 / 9.0,  2.0 /
    9.0, - 2.0 / 9.0, - 8.0 / 9.0,  2.0 / 9.0,        0.0, - 8.0 / 9.0,  2.0 /
    9.0,    2.0 / 9.0, - 8.0 / 9.0,  2.0 / 9.0,
    4.0 / 9.0, - 8.0 / 9.0,  2.0 / 9.0,    6.0 / 9.0, - 8.0 / 9.0,  2.0 /
    9.0,    8.0 / 9.0, - 8.0 / 9.0,  2.0 / 9.0, - 8.0 / 9.0, - 6.0 / 9.0,  2.0 /
    9.0, - 6.0 / 9.0, - 6.0 / 9.0,  2.0 / 9.0, - 4.0 / 9.0, - 6.0 / 9.0,  2.0 /
    9.0, - 2.0 / 9.0, - 6.0 / 9.0,  2.0 / 9.0,        0.0, - 6.0 / 9.0,  2.0 /
    9.0,    2.0 / 9.0, - 6.0 / 9.0,  2.0 / 9.0,
    4.0 / 9.0, - 6.0 / 9.0,  2.0 / 9.0,    6.0 / 9.0, - 6.0 / 9.0,  2.0 /
    9.0,    8.0 / 9.0, - 6.0 / 9.0,  2.0 / 9.0, - 8.0 / 9.0, - 4.0 / 9.0,  2.0 /
    9.0, - 6.0 / 9.0, - 4.0 / 9.0,  2.0 / 9.0, - 4.0 / 9.0, - 4.0 / 9.0,  2.0 /
    9.0, - 2.0 / 9.0, - 4.0 / 9.0,  2.0 / 9.0,        0.0, - 4.0 / 9.0,  2.0 /
    9.0,    2.0 / 9.0, - 4.0 / 9.0,  2.0 / 9.0,
    4.0 / 9.0, - 4.0 / 9.0,  2.0 / 9.0,    6.0 / 9.0, - 4.0 / 9.0,  2.0 /
    9.0,    8.0 / 9.0, - 4.0 / 9.0,  2.0 / 9.0, - 8.0 / 9.0, - 2.0 / 9.0,  2.0 /
    9.0, - 6.0 / 9.0, - 2.0 / 9.0,  2.0 / 9.0, - 4.0 / 9.0, - 2.0 / 9.0,  2.0 /
    9.0, - 2.0 / 9.0, - 2.0 / 9.0,  2.0 / 9.0,        0.0, - 2.0 / 9.0,  2.0 /
    9.0,    2.0 / 9.0, - 2.0 / 9.0,  2.0 / 9.0,
    4.0 / 9.0, - 2.0 / 9.0,  2.0 / 9.0,    6.0 / 9.0, - 2.0 / 9.0,  2.0 /
    9.0,    8.0 / 9.0, - 2.0 / 9.0,  2.0 / 9.0, - 8.0 / 9.0,      0.0,  2.0 /
    9.0, - 6.0 / 9.0,      0.0,  2.0 / 9.0, - 4.0 / 9.0,      0.0,  2.0 /
    9.0, - 2.0 / 9.0,      0.0,  2.0 / 9.0,        0.0,      0.0,  2.0 /
    9.0,    2.0 / 9.0,      0.0,  2.0 / 9.0,
    4.0 / 9.0,      0.0,  2.0 / 9.0,    6.0 / 9.0,      0.0,  2.0 /
    9.0,    8.0 / 9.0,      0.0,  2.0 / 9.0, - 8.0 / 9.0,  2.0 / 9.0,  2.0 /
    9.0, - 6.0 / 9.0,  2.0 / 9.0,  2.0 / 9.0, - 4.0 / 9.0,  2.0 / 9.0,  2.0 /
    9.0, - 2.0 / 9.0,  2.0 / 9.0,  2.0 / 9.0,        0.0,  2.0 / 9.0,  2.0 /
    9.0,    2.0 / 9.0,  2.0 / 9.0,  2.0 / 9.0,
    4.0 / 9.0,  2.0 / 9.0,  2.0 / 9.0,    6.0 / 9.0,  2.0 / 9.0,  2.0 /
    9.0,    8.0 / 9.0,  2.0 / 9.0,  2.0 / 9.0, - 8.0 / 9.0,  4.0 / 9.0,  2.0 /
    9.0, - 6.0 / 9.0,  4.0 / 9.0,  2.0 / 9.0, - 4.0 / 9.0,  4.0 / 9.0,  2.0 /
    9.0, - 2.0 / 9.0,  4.0 / 9.0,  2.0 / 9.0,        0.0,  4.0 / 9.0,  2.0 /
    9.0,    2.0 / 9.0,  4.0 / 9.0,  2.0 / 9.0,
    4.0 / 9.0,  4.0 / 9.0,  2.0 / 9.0,    6.0 / 9.0,  4.0 / 9.0,  2.0 /
    9.0,    8.0 / 9.0,  4.0 / 9.0,  2.0 / 9.0, - 8.0 / 9.0,  6.0 / 9.0,  2.0 /
    9.0, - 6.0 / 9.0,  6.0 / 9.0,  2.0 / 9.0, - 4.0 / 9.0,  6.0 / 9.0,  2.0 /
    9.0, - 2.0 / 9.0,  6.0 / 9.0,  2.0 / 9.0,        0.0,  6.0 / 9.0,  2.0 /
    9.0,    2.0 / 9.0,  6.0 / 9.0,  2.0 / 9.0,
    4.0 / 9.0,  6.0 / 9.0,  2.0 / 9.0,    6.0 / 9.0,  6.0 / 9.0,  2.0 /
    9.0,    8.0 / 9.0,  6.0 / 9.0,  2.0 / 9.0, - 8.0 / 9.0,  8.0 / 9.0,  2.0 /
    9.0, - 6.0 / 9.0,  8.0 / 9.0,  2.0 / 9.0, - 4.0 / 9.0,  8.0 / 9.0,  2.0 /
    9.0, - 2.0 / 9.0,  8.0 / 9.0,  2.0 / 9.0,        0.0,  8.0 / 9.0,  2.0 /
    9.0,    2.0 / 9.0,  8.0 / 9.0,  2.0 / 9.0,
    4.0 / 9.0,  8.0 / 9.0,  2.0 / 9.0,    6.0 / 9.0,  8.0 / 9.0,  2.0 /
    9.0,    8.0 / 9.0,  8.0 / 9.0,  2.0 / 9.0, - 8.0 / 9.0, - 8.0 / 9.0,  4.0 /
    9.0, - 6.0 / 9.0, - 8.0 / 9.0,  4.0 / 9.0, - 4.0 / 9.0, - 8.0 / 9.0,  4.0 /
    9.0, - 2.0 / 9.0, - 8.0 / 9.0,  4.0 / 9.0,        0.0, - 8.0 / 9.0,  4.0 /
    9.0,    2.0 / 9.0, - 8.0 / 9.0,  4.0 / 9.0,
    4.0 / 9.0, - 8.0 / 9.0,  4.0 / 9.0,    6.0 / 9.0, - 8.0 / 9.0,  4.0 /
    9.0,    8.0 / 9.0, - 8.0 / 9.0,  4.0 / 9.0, - 8.0 / 9.0, - 6.0 / 9.0,  4.0 /
    9.0, - 6.0 / 9.0, - 6.0 / 9.0,  4.0 / 9.0, - 4.0 / 9.0, - 6.0 / 9.0,  4.0 /
    9.0, - 2.0 / 9.0, - 6.0 / 9.0,  4.0 / 9.0,        0.0, - 6.0 / 9.0,  4.0 /
    9.0,    2.0 / 9.0, - 6.0 / 9.0,  4.0 / 9.0,
    4.0 / 9.0, - 6.0 / 9.0,  4.0 / 9.0,    6.0 / 9.0, - 6.0 / 9.0,  4.0 /
    9.0,    8.0 / 9.0, - 6.0 / 9.0,  4.0 / 9.0, - 8.0 / 9.0, - 4.0 / 9.0,  4.0 /
    9.0, - 6.0 / 9.0, - 4.0 / 9.0,  4.0 / 9.0, - 4.0 / 9.0, - 4.0 / 9.0,  4.0 /
    9.0, - 2.0 / 9.0, - 4.0 / 9.0,  4.0 / 9.0,        0.0, - 4.0 / 9.0,  4.0 /
    9.0,    2.0 / 9.0, - 4.0 / 9.0,  4.0 / 9.0,
    4.0 / 9.0, - 4.0 / 9.0,  4.0 / 9.0,    6.0 / 9.0, - 4.0 / 9.0,  4.0 /
    9.0,    8.0 / 9.0, - 4.0 / 9.0,  4.0 / 9.0, - 8.0 / 9.0, - 2.0 / 9.0,  4.0 /
    9.0, - 6.0 / 9.0, - 2.0 / 9.0,  4.0 / 9.0, - 4.0 / 9.0, - 2.0 / 9.0,  4.0 /
    9.0, - 2.0 / 9.0, - 2.0 / 9.0,  4.0 / 9.0,        0.0, - 2.0 / 9.0,  4.0 /
    9.0,    2.0 / 9.0, - 2.0 / 9.0,  4.0 / 9.0,
    4.0 / 9.0, - 2.0 / 9.0,  4.0 / 9.0,    6.0 / 9.0, - 2.0 / 9.0,  4.0 /
    9.0,    8.0 / 9.0, - 2.0 / 9.0,  4.0 / 9.0, - 8.0 / 9.0,      0.0,  4.0 /
    9.0, - 6.0 / 9.0,      0.0,  4.0 / 9.0, - 4.0 / 9.0,      0.0,  4.0 /
    9.0, - 2.0 / 9.0,      0.0,  4.0 / 9.0,        0.0,      0.0,  4.0 /
    9.0,    2.0 / 9.0,      0.0,  4.0 / 9.0,
    4.0 / 9.0,      0.0,  4.0 / 9.0,    6.0 / 9.0,      0.0,  4.0 /
    9.0,    8.0 / 9.0,      0.0,  4.0 / 9.0, - 8.0 / 9.0,  2.0 / 9.0,  4.0 /
    9.0, - 6.0 / 9.0,  2.0 / 9.0,  4.0 / 9.0, - 4.0 / 9.0,  2.0 / 9.0,  4.0 /
    9.0, - 2.0 / 9.0,  2.0 / 9.0,  4.0 / 9.0,        0.0,  2.0 / 9.0,  4.0 /
    9.0,    2.0 / 9.0,  2.0 / 9.0,  4.0 / 9.0,
    4.0 / 9.0,  2.0 / 9.0,  4.0 / 9.0,    6.0 / 9.0,  2.0 / 9.0,  4.0 /
    9.0,    8.0 / 9.0,  2.0 / 9.0,  4.0 / 9.0, - 8.0 / 9.0,  4.0 / 9.0,  4.0 /
    9.0, - 6.0 / 9.0,  4.0 / 9.0,  4.0 / 9.0, - 4.0 / 9.0,  4.0 / 9.0,  4.0 /
    9.0, - 2.0 / 9.0,  4.0 / 9.0,  4.0 / 9.0,        0.0,  4.0 / 9.0,  4.0 /
    9.0,    2.0 / 9.0,  4.0 / 9.0,  4.0 / 9.0,
    4.0 / 9.0,  4.0 / 9.0,  4.0 / 9.0,    6.0 / 9.0,  4.0 / 9.0,  4.0 /
    9.0,    8.0 / 9.0,  4.0 / 9.0,  4.0 / 9.0, - 8.0 / 9.0,  6.0 / 9.0,  4.0 /
    9.0, - 6.0 / 9.0,  6.0 / 9.0,  4.0 / 9.0, - 4.0 / 9.0,  6.0 / 9.0,  4.0 /
    9.0, - 2.0 / 9.0,  6.0 / 9.0,  4.0 / 9.0,        0.0,  6.0 / 9.0,  4.0 /
    9.0,    2.0 / 9.0,  6.0 / 9.0,  4.0 / 9.0,
    4.0 / 9.0,  6.0 / 9.0,  4.0 / 9.0,    6.0 / 9.0,  6.0 / 9.0,  4.0 /
    9.0,    8.0 / 9.0,  6.0 / 9.0,  4.0 / 9.0, - 8.0 / 9.0,  8.0 / 9.0,  4.0 /
    9.0, - 6.0 / 9.0,  8.0 / 9.0,  4.0 / 9.0, - 4.0 / 9.0,  8.0 / 9.0,  4.0 /
    9.0, - 2.0 / 9.0,  8.0 / 9.0,  4.0 / 9.0,        0.0,  8.0 / 9.0,  4.0 /
    9.0,    2.0 / 9.0,  8.0 / 9.0,  4.0 / 9.0,
    4.0 / 9.0,  8.0 / 9.0,  4.0 / 9.0,    6.0 / 9.0,  8.0 / 9.0,  4.0 /
    9.0,    8.0 / 9.0,  8.0 / 9.0,  4.0 / 9.0, - 8.0 / 9.0, - 8.0 / 9.0,  6.0 /
    9.0, - 6.0 / 9.0, - 8.0 / 9.0,  6.0 / 9.0, - 4.0 / 9.0, - 8.0 / 9.0,  6.0 /
    9.0, - 2.0 / 9.0, - 8.0 / 9.0,  6.0 / 9.0,        0.0, - 8.0 / 9.0,  6.0 /
    9.0,    2.0 / 9.0, - 8.0 / 9.0,  6.0 / 9.0,
    4.0 / 9.0, - 8.0 / 9.0,  6.0 / 9.0,    6.0 / 9.0, - 8.0 / 9.0,  6.0 /
    9.0,    8.0 / 9.0, - 8.0 / 9.0,  6.0 / 9.0, - 8.0 / 9.0, - 6.0 / 9.0,  6.0 /
    9.0, - 6.0 / 9.0, - 6.0 / 9.0,  6.0 / 9.0, - 4.0 / 9.0, - 6.0 / 9.0,  6.0 /
    9.0, - 2.0 / 9.0, - 6.0 / 9.0,  6.0 / 9.0,        0.0, - 6.0 / 9.0,  6.0 /
    9.0,    2.0 / 9.0, - 6.0 / 9.0,  6.0 / 9.0,
    4.0 / 9.0, - 6.0 / 9.0,  6.0 / 9.0,    6.0 / 9.0, - 6.0 / 9.0,  6.0 /
    9.0,    8.0 / 9.0, - 6.0 / 9.0,  6.0 / 9.0, - 8.0 / 9.0, - 4.0 / 9.0,  6.0 /
    9.0, - 6.0 / 9.0, - 4.0 / 9.0,  6.0 / 9.0, - 4.0 / 9.0, - 4.0 / 9.0,  6.0 /
    9.0, - 2.0 / 9.0, - 4.0 / 9.0,  6.0 / 9.0,        0.0, - 4.0 / 9.0,  6.0 /
    9.0,    2.0 / 9.0, - 4.0 / 9.0,  6.0 / 9.0,
    4.0 / 9.0, - 4.0 / 9.0,  6.0 / 9.0,    6.0 / 9.0, - 4.0 / 9.0,  6.0 /
    9.0,    8.0 / 9.0, - 4.0 / 9.0,  6.0 / 9.0, - 8.0 / 9.0, - 2.0 / 9.0,  6.0 /
    9.0, - 6.0 / 9.0, - 2.0 / 9.0,  6.0 / 9.0, - 4.0 / 9.0, - 2.0 / 9.0,  6.0 /
    9.0, - 2.0 / 9.0, - 2.0 / 9.0,  6.0 / 9.0,        0.0, - 2.0 / 9.0,  6.0 /
    9.0,    2.0 / 9.0, - 2.0 / 9.0,  6.0 / 9.0,
    4.0 / 9.0, - 2.0 / 9.0,  6.0 / 9.0,    6.0 / 9.0, - 2.0 / 9.0,  6.0 /
    9.0,    8.0 / 9.0, - 2.0 / 9.0,  6.0 / 9.0, - 8.0 / 9.0,      0.0,  6.0 /
    9.0, - 6.0 / 9.0,      0.0,  6.0 / 9.0, - 4.0 / 9.0,      0.0,  6.0 /
    9.0, - 2.0 / 9.0,      0.0,  6.0 / 9.0,        0.0,      0.0,  6.0 /
    9.0,    2.0 / 9.0,      0.0,  6.0 / 9.0,
    4.0 / 9.0,      0.0,  6.0 / 9.0,    6.0 / 9.0,      0.0,  6.0 /
    9.0,    8.0 / 9.0,      0.0,  6.0 / 9.0, - 8.0 / 9.0,  2.0 / 9.0,  6.0 /
    9.0, - 6.0 / 9.0,  2.0 / 9.0,  6.0 / 9.0, - 4.0 / 9.0,  2.0 / 9.0,  6.0 /
    9.0, - 2.0 / 9.0,  2.0 / 9.0,  6.0 / 9.0,        0.0,  2.0 / 9.0,  6.0 /
    9.0,    2.0 / 9.0,  2.0 / 9.0,  6.0 / 9.0,
    4.0 / 9.0,  2.0 / 9.0,  6.0 / 9.0,    6.0 / 9.0,  2.0 / 9.0,  6.0 /
    9.0,    8.0 / 9.0,  2.0 / 9.0,  6.0 / 9.0, - 8.0 / 9.0,  4.0 / 9.0,  6.0 /
    9.0, - 6.0 / 9.0,  4.0 / 9.0,  6.0 / 9.0, - 4.0 / 9.0,  4.0 / 9.0,  6.0 /
    9.0, - 2.0 / 9.0,  4.0 / 9.0,  6.0 / 9.0,        0.0,  4.0 / 9.0,  6.0 /
    9.0,    2.0 / 9.0,  4.0 / 9.0,  6.0 / 9.0,
    4.0 / 9.0,  4.0 / 9.0,  6.0 / 9.0,    6.0 / 9.0,  4.0 / 9.0,  6.0 /
    9.0,    8.0 / 9.0,  4.0 / 9.0,  6.0 / 9.0, - 8.0 / 9.0,  6.0 / 9.0,  6.0 /
    9.0, - 6.0 / 9.0,  6.0 / 9.0,  6.0 / 9.0, - 4.0 / 9.0,  6.0 / 9.0,  6.0 /
    9.0, - 2.0 / 9.0,  6.0 / 9.0,  6.0 / 9.0,        0.0,  6.0 / 9.0,  6.0 /
    9.0,    2.0 / 9.0,  6.0 / 9.0,  6.0 / 9.0,
    4.0 / 9.0,  6.0 / 9.0,  6.0 / 9.0,    6.0 / 9.0,  6.0 / 9.0,  6.0 /
    9.0,    8.0 / 9.0,  6.0 / 9.0,  6.0 / 9.0, - 8.0 / 9.0,  8.0 / 9.0,  6.0 /
    9.0, - 6.0 / 9.0,  8.0 / 9.0,  6.0 / 9.0, - 4.0 / 9.0,  8.0 / 9.0,  6.0 /
    9.0, - 2.0 / 9.0,  8.0 / 9.0,  6.0 / 9.0,        0.0,  8.0 / 9.0,  6.0 /
    9.0,    2.0 / 9.0,  8.0 / 9.0,  6.0 / 9.0,
    4.0 / 9.0,  8.0 / 9.0,  6.0 / 9.0,    6.0 / 9.0,  8.0 / 9.0,  6.0 /
    9.0,    8.0 / 9.0,  8.0 / 9.0,  6.0 / 9.0, - 8.0 / 9.0, - 8.0 / 9.0,  8.0 /
    9.0, - 6.0 / 9.0, - 8.0 / 9.0,  8.0 / 9.0, - 4.0 / 9.0, - 8.0 / 9.0,  8.0 /
    9.0, - 2.0 / 9.0, - 8.0 / 9.0,  8.0 / 9.0,        0.0, - 8.0 / 9.0,  8.0 /
    9.0,    2.0 / 9.0, - 8.0 / 9.0,  8.0 / 9.0,
    4.0 / 9.0, - 8.0 / 9.0,  8.0 / 9.0,    6.0 / 9.0, - 8.0 / 9.0,  8.0 /
    9.0,    8.0 / 9.0, - 8.0 / 9.0,  8.0 / 9.0, - 8.0 / 9.0, - 6.0 / 9.0,  8.0 /
    9.0, - 6.0 / 9.0, - 6.0 / 9.0,  8.0 / 9.0, - 4.0 / 9.0, - 6.0 / 9.0,  8.0 /
    9.0, - 2.0 / 9.0, - 6.0 / 9.0,  8.0 / 9.0,        0.0, - 6.0 / 9.0,  8.0 /
    9.0,    2.0 / 9.0, - 6.0 / 9.0,  8.0 / 9.0,
    4.0 / 9.0, - 6.0 / 9.0,  8.0 / 9.0,    6.0 / 9.0, - 6.0 / 9.0,  8.0 /
    9.0,    8.0 / 9.0, - 6.0 / 9.0,  8.0 / 9.0, - 8.0 / 9.0, - 4.0 / 9.0,  8.0 /
    9.0, - 6.0 / 9.0, - 4.0 / 9.0,  8.0 / 9.0, - 4.0 / 9.0, - 4.0 / 9.0,  8.0 /
    9.0, - 2.0 / 9.0, - 4.0 / 9.0,  8.0 / 9.0,        0.0, - 4.0 / 9.0,  8.0 /
    9.0,    2.0 / 9.0, - 4.0 / 9.0,  8.0 / 9.0,
    4.0 / 9.0, - 4.0 / 9.0,  8.0 / 9.0,    6.0 / 9.0, - 4.0 / 9.0,  8.0 /
    9.0,    8.0 / 9.0, - 4.0 / 9.0,  8.0 / 9.0, - 8.0 / 9.0, - 2.0 / 9.0,  8.0 /
    9.0, - 6.0 / 9.0, - 2.0 / 9.0,  8.0 / 9.0, - 4.0 / 9.0, - 2.0 / 9.0,  8.0 /
    9.0, - 2.0 / 9.0, - 2.0 / 9.0,  8.0 / 9.0,        0.0, - 2.0 / 9.0,  8.0 /
    9.0,    2.0 / 9.0, - 2.0 / 9.0,  8.0 / 9.0,
    4.0 / 9.0, - 2.0 / 9.0,  8.0 / 9.0,    6.0 / 9.0, - 2.0 / 9.0,  8.0 /
    9.0,    8.0 / 9.0, - 2.0 / 9.0,  8.0 / 9.0, - 8.0 / 9.0,      0.0,  8.0 /
    9.0, - 6.0 / 9.0,      0.0,  8.0 / 9.0, - 4.0 / 9.0,      0.0,  8.0 /
    9.0, - 2.0 / 9.0,      0.0,  8.0 / 9.0,        0.0,      0.0,  8.0 /
    9.0,    2.0 / 9.0,      0.0,  8.0 / 9.0,
    4.0 / 9.0,      0.0,  8.0 / 9.0,    6.0 / 9.0,      0.0,  8.0 /
    9.0,    8.0 / 9.0,      0.0,  8.0 / 9.0, - 8.0 / 9.0,  2.0 / 9.0,  8.0 /
    9.0, - 6.0 / 9.0,  2.0 / 9.0,  8.0 / 9.0, - 4.0 / 9.0,  2.0 / 9.0,  8.0 /
    9.0, - 2.0 / 9.0,  2.0 / 9.0,  8.0 / 9.0,        0.0,  2.0 / 9.0,  8.0 /
    9.0,    2.0 / 9.0,  2.0 / 9.0,  8.0 / 9.0,
    4.0 / 9.0,  2.0 / 9.0,  8.0 / 9.0,    6.0 / 9.0,  2.0 / 9.0,  8.0 /
    9.0,    8.0 / 9.0,  2.0 / 9.0,  8.0 / 9.0, - 8.0 / 9.0,  4.0 / 9.0,  8.0 /
    9.0, - 6.0 / 9.0,  4.0 / 9.0,  8.0 / 9.0, - 4.0 / 9.0,  4.0 / 9.0,  8.0 /
    9.0, - 2.0 / 9.0,  4.0 / 9.0,  8.0 / 9.0,        0.0,  4.0 / 9.0,  8.0 /
    9.0,    2.0 / 9.0,  4.0 / 9.0,  8.0 / 9.0,
    4.0 / 9.0,  4.0 / 9.0,  8.0 / 9.0,    6.0 / 9.0,  4.0 / 9.0,  8.0 /
    9.0,    8.0 / 9.0,  4.0 / 9.0,  8.0 / 9.0, - 8.0 / 9.0,  6.0 / 9.0,  8.0 /
    9.0, - 6.0 / 9.0,  6.0 / 9.0,  8.0 / 9.0, - 4.0 / 9.0,  6.0 / 9.0,  8.0 /
    9.0, - 2.0 / 9.0,  6.0 / 9.0,  8.0 / 9.0,        0.0,  6.0 / 9.0,  8.0 /
    9.0,    2.0 / 9.0,  6.0 / 9.0,  8.0 / 9.0,
    4.0 / 9.0,  6.0 / 9.0,  8.0 / 9.0,    6.0 / 9.0,  6.0 / 9.0,  8.0 /
    9.0,    8.0 / 9.0,  6.0 / 9.0,  8.0 / 9.0, - 8.0 / 9.0,  8.0 / 9.0,  8.0 /
    9.0, - 6.0 / 9.0,  8.0 / 9.0,  8.0 / 9.0, - 4.0 / 9.0,  8.0 / 9.0,  8.0 /
    9.0, - 2.0 / 9.0,  8.0 / 9.0,  8.0 / 9.0,        0.0,  8.0 / 9.0,  8.0 /
    9.0,    2.0 / 9.0,  8.0 / 9.0,  8.0 / 9.0,
    4.0 / 9.0,  8.0 / 9.0,  8.0 / 9.0,    6.0 / 9.0,  8.0 / 9.0,  8.0 /
    9.0,    8.0 / 9.0,  8.0 / 9.0,  8.0 / 9.0);

  // data taken from ISO/IEC DIS 11172, Annexes 3-B.2[abcd] and 3-B.4:

  // subbands 0-2 in tables 3-B.2a and 2b: (index is allocation)
  // bits per codeword
  TableAB1CodeLength: array[0..15] of
  cardinal = (0, 5, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16);

  // pointer to sample grouping table, or NULL-pointer if ungrouped
  TableAB1GroupingTables: array[0..15] of PSingleArray = (nil,
    @Grouping5bits, nil, nil, nil, nil, nil, nil, nil, nil, nil, nil, nil, nil, nil, nil);

  // factor for requantization: (real)sample * factor - 1.0 gives requantized sample
  TableAB1Factor: array[0..15] of single = (0.0, 1.0 / 2.0, 1.0 / 4.0, 1.0 /
    8.0, 1.0 / 16.0, 1.0 / 32.0, 1.0 / 64.0,
    1.0 / 128.0, 1.0 / 256.0, 1.0 / 512.0, 1.0 / 1024.0, 1.0 / 2048.0,
    1.0 / 4096.0, 1.0 / 8192.0, 1.0 / 16384.0, 1.0 / 32768.0);

  // factor c for requantization from table 3-B.4
  TableAB1C: array[0..15] of single = (0.0,           1.33333333333, 1.14285714286,
    1.06666666666, 1.03225806452,
    1.01587301587, 1.00787401575, 1.00392156863, 1.00195694716, 1.00097751711,
    1.00048851979, 1.00024420024, 1.00012208522, 1.00006103888, 1.00003051851,
    1.00001525902);

  // addend d for requantization from table 3-B.4
  TableAB1D: array[0..15] of single = (0.0,           0.50000000000, 0.25000000000,
    0.12500000000, 0.06250000000,
    0.03125000000, 0.01562500000, 0.00781250000, 0.00390625000, 0.00195312500,
    0.00097656250, 0.00048828125, 0.00024414063, 0.00012207031, 0.00006103516,
    0.00003051758);

  // subbands 3-... tables 3-B.2a and 2b:
  TableAB234GroupingTables: array[0..15] of
  PSingleArray = (nil, @Grouping5Bits, @Grouping7Bits, nil, @Grouping10Bits,
    nil, nil, nil,
    nil, nil, nil, nil, nil, nil, nil, nil);

  // subbands 3-10 in tables 3-B.2a and 2b:
  TableAB2CodeLength: array[0..15] of
  cardinal = (0, 5, 7, 3, 10, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 16);

  TableAB2Factor: array[0..15] of single = (0.0, 1.0 / 2.0, 1.0 / 4.0, 1.0 /
    4.0, 1.0 / 8.0, 1.0 / 8.0, 1.0 / 16.0,
    1.0 / 32.0, 1.0 / 64.0, 1.0 / 128.0, 1.0 / 256.0, 1.0 / 512.0,
    1.0 / 1024.0, 1.0 / 2048.0, 1.0 / 4096.0, 1.0 / 32768.0);

  TableAB2C: array[0..15] of single = (0.0,           1.33333333333, 1.60000000000,
    1.14285714286, 1.77777777777,
    1.06666666666, 1.03225806452, 1.01587301587, 1.00787401575, 1.00392156863,
    1.00195694716, 1.00097751711, 1.00048851979, 1.00024420024, 1.00012208522,
    1.00001525902);

  TableAB2D: array[0..15] of single = (0.0,           0.50000000000, 0.50000000000,
    0.25000000000, 0.50000000000,
    0.12500000000, 0.06250000000, 0.03125000000, 0.01562500000, 0.00781250000,
    0.00390625000, 0.00195312500, 0.00097656250, 0.00048828125, 0.00024414063,
    0.00003051758);

  // subbands 11-22 in tables 3-B.2a and 2b:
  TableAB3CodeLength: array[0..7] of cardinal = (0, 5, 7, 3, 10, 4, 5, 16);

  TableAB3Factor: array[0..7] of single = (0.0, 1.0 / 2.0, 1.0 / 4.0, 1.0 /
    4.0, 1.0 / 8.0, 1.0 / 8.0, 1.0 / 16.0, 1.0 / 32768.0);

  TableAB3C: array[0..7] of single = (0.0,           1.33333333333, 1.60000000000,
    1.14285714286, 1.77777777777,
    1.06666666666, 1.03225806452, 1.00001525902);

  TableAB3D: array[0..7] of single = (0.0,           0.50000000000, 0.50000000000,
    0.25000000000, 0.50000000000,
    0.12500000000, 0.06250000000, 0.00003051758);

  // subbands 23-... in tables 3-B.2a and 2b:
  TableAB4CodeLength: array[0..3] of cardinal = (0, 5, 7, 16);

  TableAB4Factor: array[0..3] of single = (0.0, 1.0 / 2.0, 1.0 / 4.0, 1.0 / 32768.0);

  TableAB4C: array[0..3] of single = (0.0, 1.33333333333, 1.60000000000, 1.00001525902);

  TableAB4D: array[0..3] of single = (0.0, 0.50000000000, 0.50000000000, 0.00003051758);

  // subbands in tables 3-B.2c and 2d:
  TableCDCodeLength: array[0..15] of cardinal = (0, 5, 7, 10, 4, 5, 6,
    7, 8, 9, 10, 11, 12, 13, 14, 15);

  TableCDGroupingTables: array[0..15] of PSingleArray = (nil, @Grouping5Bits,
    @Grouping7Bits, @Grouping10Bits, nil, nil, nil, nil,
    nil, nil, nil, nil, nil, nil, nil, nil);

  TableCDFactor: array[0..15] of single = (0.0, 1.0 / 2.0, 1.0 / 4.0, 1.0 /
    8.0, 1.0 / 8.0, 1.0 / 16.0, 1.0 / 32.0, 1.0 / 64.0,
    1.0 / 128.0, 1.0 / 256.0, 1.0 / 512.0, 1.0 / 1024.0, 1.0 / 2048.0, 1.0 / 4096.0,
    1.0 / 8192.0, 1.0 / 16384.0);

  TableCDC: array[0..15] of single = (0.0,           1.33333333333, 1.60000000000,
    1.77777777777, 1.06666666666,
    1.03225806452, 1.01587301587, 1.00787401575, 1.00392156863, 1.00195694716,
    1.00097751711, 1.00048851979, 1.00024420024, 1.00012208522, 1.00006103888,
    1.00003051851);

  TableCDD: array[0..15] of single = (0.0,           0.50000000000, 0.50000000000,
    0.50000000000, 0.12500000000,
    0.06250000000, 0.03125000000, 0.01562500000, 0.00781250000, 0.00390625000,
    0.00195312500, 0.00097656250, 0.00048828125, 0.00024414063, 0.00012207031,
    0.00006103516);

  { TSubBandLayer2 }

function newSubBandLayer2(SubBandNumber: cardinal): Psubbandlayer2;
begin
  New(Result, Create);
  Result.FSubBandNumber := SubBandNumber;
  Result.FGroupNumber := 0;
  Result.FSampleNumber := 0;
end;

function newSubBandLayer2Stereo(SubBandNumber: cardinal): Psubbandlayer2Stereo;
begin
  New(Result, Create);
  Result.FSubBandNumber := SubBandNumber;
  Result.FGroupNumber := 0;
  Result.FSampleNumber := 0;
end;

function newSubBandLayer2intensitystereo(SubBandNumber: cardinal)
  : Psubbandlayer2IntensityStereo;
begin
  New(Result, Create);
  Result.FSubBandNumber := SubBandNumber;
  Result.FGroupNumber := 0;
  Result.FSampleNumber := 0;
end;

function TSubBandLayer2.GetAllocationLength(Header: PHeader): cardinal;
var 
  ChannelBitrate: cardinal;
begin
  if (Header.Version = MPEG1) then 
  begin
    ChannelBitrate := Header.BitrateIndex;

    // calculate bitrate per channel:
    if (Header.Mode <> SingleChannel) then
      if (ChannelBitrate = 4) then
        ChannelBitrate := 1
      else
        dec(ChannelBitrate, 4);

    if (ChannelBitrate = 1) or (ChannelBitrate = 2) then 
    begin
      // table 3-B.2c or 3-B.2d
      if (FSubBandNumber <= 1) then
        Result := 4
      else
        Result := 3;

      exit;
    end 
    else 
    begin
      // tables 3-B.2a or 3-B.2b
      if (FSubBandNumber <= 10) then
        Result := 4
      else if (FSubBandNumber <= 22) then
        Result := 3
      else
        Result := 2;

      exit;
    end;
  end 
  else 
  begin  // MPEG-2 LSF -- Jeff
    // table B.1 of ISO/IEC 13818-3
    if (FSubBandNumber <= 3) then
      Result := 4
    else if (FSubBandNumber <= 10) then
      Result := 3
    else
      Result := 2;

    exit;
  end;
end;

procedure TSubBandLayer2.PrepareSampleReading(Header: PHeader; Allocation: cardinal;
  var GroupingTable: PSingleArray; var Factor: single; var CodeLength: cardinal; var C,
  D: single);
var 
  ChannelBitrate: cardinal;
begin
  ChannelBitrate := Header.BitrateIndex;

  // calculate bitrate per channel:
  if (Header.Mode <> SingleChannel) then
    if (ChannelBitrate = 4) then
      ChannelBitrate := 1
    else
      dec(ChannelBitrate, 4);

  if (ChannelBitrate = 1) or (ChannelBitrate = 2) then 
  begin
    // table 3-B.2c or 3-B.2d
    GroupingTable := TableCDGroupingtables[Allocation];
    Factor := TableCDFactor[Allocation];
    CodeLength := TableCDCodelength[Allocation];
    C := TableCDC[Allocation];
    D := TableCDD[Allocation];
  end 
  else 
  begin
    // tables 3-B.2a or 3-B.2b
    if (FSubBandNumber <= 2) then 
    begin
      Groupingtable := TableAB1GroupingTables[Allocation];
      Factor := TableAB1Factor[Allocation];
      CodeLength := TableAB1CodeLength[Allocation];
      C := TableAB1C[Allocation];
      D := TableAB1D[Allocation];
    end 
    else 
    begin
      GroupingTable := TableAB234GroupingTables[Allocation];
      if (FSubBandNumber <= 10) then 
      begin
        Factor := TableAB2Factor[Allocation];
        CodeLength := TableAB2CodeLength[Allocation];
        C := TableAB2C[Allocation];
        D := TableAB2D[Allocation];
      end 
      else if (FSubBandNumber <= 22) then 
      begin
        Factor := TableAB3Factor[Allocation];
        CodeLength := TableAB3CodeLength[Allocation];
        C := TableAB3C[Allocation];
        D := TableAB3D[Allocation];
      end 
      else 
      begin
        Factor := TableAB4Factor[Allocation];
        CodeLength := TableAB4CodeLength[Allocation];
        C := TableAB4C[Allocation];
        D := TableAB4D[Allocation];
      end;
    end;
  end;
end;

function TSubBandLayer2.PutNextSample(Channels: TChannels; Filter1,
  Filter2: PSynthesisFilter): boolean;
var 
  Sample: single;
begin
  if (FAllocation <> 0) and (Channels <> Right) then 
  begin
    Sample := FSamples[FSampleNumber];

    if (FGroupingTable = nil) then
      Sample := (Sample + FD) * FC;

    if (FGroupNumber <= 4) then
      Sample := Sample * FScaleFactor1
    else if (FGroupNumber <= 8) then
      Sample := Sample * FScaleFactor2
    else
      Sample := Sample * FScaleFactor3;

    Filter1.InputSample(Sample, FSubBandNumber);
  end;

  inc(FSampleNumber);
  if (FSampleNumber = 3) then
    Result := True
  else
    Result := False;
end;

procedure TSubBandLayer2.ReadAllocation(Stream: PBitStream;
  Header: PHeader; CRC: PCRC16);
var 
  Length: cardinal;
begin
  Length := GetAllocationLength(Header);
  FAllocation := Stream.GetBits(Length);
  if (CRC <> nil) then
    CRC.AddBits(FAllocation, Length);
end;

function TSubBandLayer2.ReadSampleData(Stream: PBitStream): boolean;
var 
  SampleCode: cardinal;
begin
  if (FAllocation <> 0) then
    if (FGroupingTable <> nil) then 
    begin
      SampleCode := Stream.GetBits(FCodeLength);
      // create requantized samples:
      inc(SampleCode, SampleCode shl 1);
      FSamples[0] := FGroupingTable[SampleCode];
      FSamples[1] := FGroupingTable[SampleCode + 1];
      FSamples[2] := FGroupingTable[SampleCode + 2];
    end 
    else 
    begin
      FSamples[0] := Stream.GetBits(FCodeLength) * FFactor - 1.0;
      FSamples[1] := Stream.GetBits(FCodeLength) * FFactor - 1.0;
      FSamples[2] := Stream.GetBits(FCodeLength) * FFactor - 1.0;
    end;

  FSampleNumber := 0;
  inc(FGroupNumber);
  if (FGroupnumber = 12) then
    Result := True
  else
    Result := False;
end;

procedure TSubBandLayer2.ReadScaleFactor(Stream: PBitStream;
  Header: PHeader);
begin
  if (FAllocation <> 0) then 
  begin
    case FSCFSI of
      0: 
        begin
          FScaleFactor1 := ScaleFactors[Stream.GetBits(6)];
          FScaleFactor2 := ScaleFactors[Stream.GetBits(6)];
          FScaleFactor3 := ScaleFactors[Stream.GetBits(6)];
        end;

      1: 
        begin
          FScaleFactor1 := ScaleFactors[Stream.GetBits(6)];
          FScaleFactor2 := FScaleFactor1;
          FScaleFactor3 := ScaleFactors[Stream.GetBits(6)];
        end;

      2: 
        begin
          FScaleFactor1 := ScaleFactors[Stream.GetBits(6)];
          FScaleFactor2 := FScaleFactor1;
          FScaleFactor3 := FScaleFactor1;
        end;

      3: 
        begin
          FScaleFactor1 := Scalefactors[Stream.GetBits(6)];
          FScaleFactor2 := ScaleFactors[Stream.GetBits(6)];
          FScaleFactor3 := FScaleFactor2;
        end;
    end;

    PrepareSampleReading(Header, FAllocation, FGroupingtable, FFactor, FCodeLength, FC, FD);
  end;
end;

procedure TSubBandLayer2.ReadScaleFactorSelection(Stream: PBitStream; CRC: PCRC16);
begin
  if (FAllocation <> 0) then 
  begin
    FSCFSI := Stream.GetBits(2);
    if (CRC <> nil) then
      CRC.AddBits(FSCFSI, 2);
  end;
end;

{ TSubbandLayer2IntensityStereo }

function TSubbandLayer2IntensityStereo.PutNextSample(Channels: TChannels;
  Filter1, Filter2: PSynthesisFilter): boolean;
var 
  Sample, Sample2: single;
begin
  if (FAllocation <> 0) then 
  begin
    Sample := FSamples[FSampleNumber];

    if (FGroupingTable = nil) then
      Sample := (Sample + FD) * FC;

    if (Channels = Both) then 
    begin
      Sample2 := Sample;
      if (FGroupNumber <= 4) then 
      begin
        Sample := Sample * FScaleFactor1;
        Sample2 := Sample2 * FChannel2ScaleFactor1;
      end 
      else if (FGroupNumber <= 8) then 
      begin
        Sample := Sample * FScaleFactor2;
        Sample2 := Sample2 * FChannel2ScaleFactor2;
      end 
      else 
      begin
        Sample := Sample * FScaleFactor3;
        Sample2 := Sample2 * FChannel2ScaleFactor3;
      end;

      Filter1.InputSample(Sample, FSubBandNumber);
      Filter2.InputSample(Sample2, FSubBandNumber);
    end 
    else if (Channels = Left) then 
    begin
      if (FGroupNumber <= 4) then
        Sample := Sample * FScaleFactor1
      else if (FGroupNumber <= 8) then
        Sample := Sample * FScaleFactor2
      else
        Sample := Sample * FScaleFactor3;

      Filter1.InputSample(Sample, FSubBandNumber);
    end 
    else 
    begin
      if (FGroupNumber <= 4) then
        Sample := Sample * FChannel2ScaleFactor1
      else if (FGroupNumber <= 8) then
        Sample := Sample * FChannel2ScaleFactor2
      else
        Sample := Sample * FChannel2ScaleFactor3;

      Filter1.InputSample(Sample, FSubBandNumber);
    end;
  end;

  inc(FSampleNumber);
  if (FSampleNumber = 3) then
    Result := True
  else
    Result := False;
end;

procedure TSubbandLayer2IntensityStereo.ReadScaleFactor(Stream: PBitStream;
  Header: PHeader);
begin
  if (FAllocation <> 0) then 
  begin
    inherited ReadScaleFactor(Stream, Header);

    case FChannel2SCFSI of
      0: 
        begin
          FChannel2ScaleFactor1 := ScaleFactors[Stream.GetBits(6)];
          FChannel2ScaleFactor2 := ScaleFactors[Stream.GetBits(6)];
          FChannel2ScaleFactor3 := ScaleFactors[Stream.GetBits(6)];
        end;

      1: 
        begin
          FChannel2ScaleFactor1 := ScaleFactors[Stream.GetBits(6)];
          FChannel2ScaleFactor2 := FChannel2ScaleFactor1;
          FChannel2ScaleFactor3 := ScaleFactors[Stream.GetBits(6)];
        end;

      2: 
        begin
          FChannel2ScaleFactor1 := ScaleFactors[Stream.GetBits(6)];
          FChannel2ScaleFactor2 := FChannel2ScaleFactor1;
          FChannel2ScaleFactor3 := FChannel2ScaleFactor1;
        end;

      3: 
        begin
          FChannel2ScaleFactor1 := ScaleFactors[Stream.GetBits(6)];
          FChannel2ScaleFactor2 := ScaleFactors[Stream.GetBits(6)];
          FChannel2ScaleFactor3 := FChannel2ScaleFactor2;
        end;
    end;
  end;
end;

procedure TSubbandLayer2IntensityStereo.ReadScaleFactorSelection(Stream: PBitStream;
  CRC: PCRC16);
begin
  if (FAllocation <> 0) then 
  begin
    FSCFSI := Stream.GetBits(2);
    FChannel2SCFSI := Stream.GetBits(2);
    if (CRC <> nil) then 
    begin
      CRC.AddBits(FSCFSI, 2);
      CRC.AddBits(FChannel2SCFSI, 2);
    end;
  end;
end;

{ TSubbandLayer2Stereo }

function TSubbandLayer2Stereo.PutNextSample(Channels: TChannels; Filter1,
  Filter2: PSynthesisFilter): boolean;
var 
  Sample: single;
begin
  Result := inherited PutNextSample(Channels, Filter1, Filter2);

  if (FChannel2Allocation <> 0) and (Channels <> Left) then 
  begin
    Sample := FChannel2Samples[FSampleNumber - 1];

    if (FChannel2GroupingTable = nil) then
      Sample := (Sample + FChannel2D) * FChannel2C;

    if (FGroupNumber <= 4) then
      Sample := Sample * FChannel2ScaleFactor1
    else if (FGroupNumber <= 8) then
      Sample := Sample * FChannel2ScaleFactor2
    else
      Sample := Sample * FChannel2ScaleFactor3;

    if (Channels = Both) then
      Filter2.InputSample(Sample, FSubBandNumber)
    else
      Filter1.InputSample(Sample, FSubBandNumber);
  end;
end;

procedure TSubbandLayer2Stereo.ReadAllocation(Stream: PBitStream;
  Header: PHeader; CRC: PCRC16);
var 
  Length: cardinal;
begin
  Length := GetAllocationLength(Header);
  FAllocation := Stream.GetBits(Length);
  FChannel2Allocation := Stream.GetBits(Length);
  if (CRC <> nil) then 
  begin
    CRC.AddBits(FAllocation, Length);
    CRC.AddBits(FChannel2Allocation, Length);
  end;
end;

function TSubbandLayer2Stereo.ReadSampleData(Stream: PBitStream): boolean;
var 
  SampleCode: cardinal;
begin
  Result := inherited ReadSampleData(Stream);

  if (FChannel2Allocation <> 0) then
    if (FChannel2GroupingTable <> nil) then 
    begin
      SampleCode := Stream.GetBits(FChannel2CodeLength);
      // create requantized samples:
      inc(SampleCode, SampleCode shl 1);
      FChannel2Samples[0] := FChannel2GroupingTable[SampleCode];
      FChannel2Samples[1] := FChannel2GroupingTable[SampleCode + 1];
      FChannel2Samples[2] := FChannel2GroupingTable[SampleCode + 2];
    end 
    else 
    begin
      FChannel2Samples[0] := Stream.GetBits(FChannel2CodeLength) * FChannel2Factor - 1.0;
      FChannel2Samples[1] := Stream.GetBits(FChannel2CodeLength) * FChannel2Factor - 1.0;
      FChannel2Samples[2] := Stream.GetBits(FChannel2CodeLength) * FChannel2Factor - 1.0;
    end;
end;

procedure TSubbandLayer2Stereo.ReadScaleFactor(Stream: PBitStream;
  Header: PHeader);
begin
  inherited ReadScaleFactor(Stream, Header);

  if (FChannel2Allocation <> 0) then 
  begin
    case FChannel2SCFSI of
      0: 
        begin
          FChannel2ScaleFactor1 := ScaleFactors[Stream.GetBits(6)];
          FChannel2ScaleFactor2 := ScaleFactors[Stream.GetBits(6)];
          FChannel2ScaleFactor3 := ScaleFactors[Stream.GetBits(6)];
        end;

      1: 
        begin
          FChannel2ScaleFactor1 := ScaleFactors[Stream.GetBits(6)];
          FChannel2ScaleFactor2 := FChannel2ScaleFactor1;
          FChannel2ScaleFactor3 := ScaleFactors[Stream.GetBits(6)];
        end;

      2: 
        begin
          FChannel2ScaleFactor1 := ScaleFactors[Stream.GetBits(6)];
          FChannel2ScaleFactor2 := FChannel2ScaleFactor1;
          FChannel2ScaleFactor3 := FChannel2ScaleFactor1;
        end;

      3: 
        begin
          FChannel2ScaleFactor1 := ScaleFactors[Stream.GetBits(6)];
          FChannel2ScaleFactor2 := ScaleFactors[Stream.GetBits(6)];
          FChannel2ScaleFactor3 := FChannel2ScaleFactor2;
        end;
    end;

    PrepareSampleReading(Header, FChannel2Allocation, FChannel2GroupingTable,
      FChannel2Factor, FChannel2CodeLength, FChannel2C, FChannel2D);
  end;
end;

procedure TSubbandLayer2Stereo.ReadScaleFactorSelection(Stream: PBitStream;
  CRC: PCRC16);
begin
  if (FAllocation <> 0) then 
  begin
    FSCFSI := Stream.GetBits(2);
    if (CRC <> nil) then
      CRC.AddBits(FSCFSI, 2);
  end;

  if (FChannel2Allocation <> 0) then 
  begin
    FChannel2SCFSI := Stream.GetBits(2);
    if (CRC <> nil) then
      CRC.AddBits(FChannel2SCFSI, 2);
  end;
end;

end.
